(()=>{document.addEventListener("input",(function(e){if(!e.target.closest("form"))return;let t=e.target.closest("form").querySelectorAll('[data-form-button="save"], [data-form-button="cancel"]');t&&t.forEach((e=>{e.disabled=!1}))}),!1),document.addEventListener("click",(function(e){e.target.dataset.deletePrompt&&(confirm(e.target.dataset.deletePrompt)||e.preventDefault())}),!1),document.addEventListener("click",(function(e){if("cancel"!==e.target.dataset.formButton)return;if(e.stopPropagation(),!confirm("Click Ok to discard your changes, or Cancel continue editing."))return void e.preventDefault();let t=e.target.closest("form").querySelectorAll('[data-form-button="save"], [data-form-button="cancel"]');t&&(e.target.dataset.formResetHref?(e.preventDefault(),window.location=e.target.dataset.formResetHref):setTimeout((()=>{t.forEach((e=>{e.disabled=!0}))}),0))}),!1);
/**
 * PitonCMS (https://github.com/PitonCMS)
 *
 * @link      https://github.com/PitonCMS/Piton
 * @copyright Copyright 2018 Wolfgang Moritz
 * @license   AGPL-3.0-or-later with Theme Exception. See LICENSE file for details.. See LICENSE file for details.
 */
const e="collapsed",t=Array.from(document.querySelectorAll('[data-collapse-toggle^="newElementButton"]')),a=function(e){let a=t.findIndex((t=>t.dataset.collapseToggle===e));if(-1!==a){t.slice(a+1).forEach((e=>{e.classList.toggle("d-none")}))}};document.addEventListener("click",(function(t){if(!t.target.closest("[data-collapse-toggle]"))return;let n=t.target.closest("[data-collapse-toggle]").dataset.collapseToggle;n.match(/^newElementButton/)&&a(n),document.querySelector(`[data-collapse-target="${n}"]`).classList.toggle(e)}),!1),document.addEventListener("click",(function(t){if(!t.target.closest("[data-collapse-auto]"))return;let n=t.target.closest("[data-collapse-auto]").dataset.collapseAuto;document.querySelector(`[data-collapse-target="${n}"]`).classList.add(e),n.match(/^newElementButton/)&&a(n)}),!1);
/**
 * PitonCMS (https://github.com/PitonCMS)
 *
 * @link      https://github.com/PitonCMS/Piton
 * @copyright Copyright 2018 Wolfgang Moritz
 * @license   AGPL-3.0-or-later with Theme Exception. See LICENSE file for details.. See LICENSE file for details.
 */
/**
 * PitonCMS (https://github.com/PitonCMS)
 *
 * @link      https://github.com/PitonCMS/Piton
 * @copyright Copyright 2021 Wolfgang Moritz
 * @license   AGPL-3.0-or-later with Theme Exception. See LICENSE file for details.. See LICENSE file for details.
 */
let n={csrfTokenRequestHeader:"Piton-CSRF-Token",routes:{adminPageGet:"/admin/page/get",adminPageElementGet:"/admin/page/element/get",adminPageElementDelete:"/admin/page/element/delete",adminMessageSave:"/admin/message/save",adminMessageGet:"/admin/message/get",adminMessageCountGet:"/admin/message/getnewmessagecount",adminMedia:"/admin/media/",adminMediaSave:"/admin/media/save",adminMediaGet:"/admin/media/get/",adminMediaControlsGet:"/admin/media/getmediacontrols",adminMediaCategorySaveOrder:"/admin/media/category/saveorder",adminMediaDelete:"/admin/media/delete",adminMediaCategoryDelete:"/admin/media/category/delete",adminMediaUploadFormGet:"/admin/media/uploadform",adminMediaUploadFile:"/admin/media/upload",adminCollection:"/admin/collection/",adminNavigationDelete:"/admin/navigation/delete",submitMessage:"/submitmessage"}};"object"==typeof config&&(n={...n,...config});const r=document.querySelector('[data-alert-modal="true"]'),o=function(e,t,a){if(a=Array.isArray(a)&&null!==a?a.join("<br>"):a instanceof Error?a.message:"object"==typeof a&&null!==a?Object.values(a).join("<br>"):String(a),r){let o=document.createElement("div");o.innerHTML=n.alertInlineHTML,o.querySelector('[data-alert="container"]').classList.add("alert-"+e),o.querySelector('[data-alert="heading"]').innerHTML=t,o.querySelector('[data-alert="content"]').innerHTML=a,r.insertAdjacentHTML("afterbegin",o.innerHTML),window.scrollTo(0,0)}else alert(a)};document.addEventListener("click",(function(e){"alert"===e.target.dataset.dismiss&&e.target.closest('[data-alert="container"]')?.remove()}),!1);
/**
 * PitonCMS (https://github.com/PitonCMS)
 *
 * @link      https://github.com/PitonCMS/Piton
 * @copyright Copyright 2018 Wolfgang Moritz
 * @license   AGPL-3.0-or-later with Theme Exception. See LICENSE file for details.. See LICENSE file for details.
 */
const l=function(){document.querySelector('[data-spinner="true"]')?.remove()};
/**
 * PitonCMS (https://github.com/PitonCMS)
 *
 * @link      https://github.com/PitonCMS/Piton
 * @copyright Copyright 2018 Wolfgang Moritz
 * @license   AGPL-3.0-or-later with Theme Exception. See LICENSE file for details.. See LICENSE file for details.
 */
let d;const i=new Event("input",{bubbles:!0}),c=document.createElement("div");c.classList.add("drag-drop");const s=function(e){d=e.target,e.dataTransfer.setData("text/plain",null),e.dataTransfer.dropEffect="move",setTimeout((()=>{document.querySelectorAll('[draggable="true"]').forEach((e=>{e===d||e===d.nextElementSibling||d.contains(e)||e.parentElement.insertBefore(c.cloneNode(),e),e===e.parentElement.lastElementChild&&e!==d&&e.parentElement.appendChild(c.cloneNode())})),document.querySelectorAll('[data-drop-zone="1"]').forEach((e=>{d.contains(e)||e.parentElement.insertBefore(c.cloneNode(),e)}))}),0)},u=function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",e.target.matches(".drag-drop")&&e.target.classList.add("drag-hover")},m=function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move"},g=function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",e.target.matches(".drag-drop")&&e.target.classList.remove("drag-hover")},p=function(e){document.querySelectorAll(".drag-drop").forEach((e=>{e.remove()})),d.dispatchEvent(i)},v=function(e,t,a){let r=new XMLHttpRequest;return new Promise(((o,l)=>{let d;r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE)try{if(200===r.status){if(d=JSON.parse(r.responseText),"success"===d.status)return o(d.text);throw new Error(`Application Error ${d.text}`)}throw new Error(`Server Error ${r.status} ${r.statusText}.`)}catch(e){if(!(e instanceof Error)){let e=new Error(e)}return l(e.message)}},r.open(e,t,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"===e&&n.csrfTokenValue&&r.setRequestHeader(n.csrfTokenRequestHeader,n.csrfTokenValue),r.send(a)}))},f=function(e,t){let a;if(t instanceof FormData)a=t;else{a=new FormData;for(let[e,n]of Object.entries(t))a.append(e,n)}return v("POST",e,a)},E=[],y=document.querySelectorAll('[data-add-nav="page"] input'),S=document.querySelectorAll('[data-add-nav="collection"] input'),T=document.querySelectorAll('[data-add-nav="placeholder"] input'),q=document.querySelector('[data-navigation="spare"] > div'),h=document.querySelector('[data-navigation-container="1"]');let L=0;const b=function(){E.forEach((e=>{let t=q.cloneNode(!0),a=L+++"n";t.querySelectorAll("input[name^=nav]").forEach((e=>{e.name=e.name.replace(/(.+?\[)(\].+)/,"$1"+a+"$2")})),t.dataset.navId=a,t.querySelector("[data-collapse-toggle]").dataset.collapseToggle=a,t.querySelector("[data-collapse-target]").dataset.collapseTarget=a,e.pageId?(t.querySelector('input[name$="[pageId]"]').value=e.pageId,t.querySelector('[data-nav="title"]').innerHTML=e.pageTitle,t.querySelector('[data-nav="type"]').innerHTML="page",t.querySelector('[data-nav="pageTitle"]').innerHTML=e.pageTitle,t.querySelector('[data-nav="pageTitle"]').parentElement.classList.remove("d-none")):e.navTitle?(t.querySelector('[data-nav="title"]').innerHTML=e.navTitle,t.querySelector('[data-nav="type"]').innerHTML="placeholder",t.querySelector('input[name$="[navTitle]"]').value=e.navTitle,t.querySelector('input[name$="[url]"]').value=e.url,t.querySelector('input[name$="[url]"]').parentElement.classList.remove("d-none")):e.collectionId&&(t.querySelector('input[name$="[collectionId]"]').value=e.collectionId,t.querySelector('[data-nav="title"]').innerHTML=e.collectionTitle,t.querySelector('[data-nav="type"]').innerHTML="collection",t.querySelector('[data-nav="collectionTitle"]').innerHTML=e.collectionTitle,t.querySelector('[data-nav="collectionTitle"]').parentElement.classList.remove("d-none")),h.appendChild(t),t.dispatchEvent(new Event("input",{bubbles:!0}))})),E.length=0},M=function(e){e.preventDefault(),e.stopPropagation();let t=d;if(t!==e.target&&e.target.matches(".drag-drop")){let a=t.querySelector('input[name$="[parentId]"]').value,n=e.target.parentElement.closest('[data-navigation="parent"]');a===n.dataset.navId&&e.target.parentElement.insertBefore(t,e.target.nextSibling),a!==n.dataset.navId&&(t.querySelector('input[name$="[parentId]"]').value=n.dataset.navId,""===n.dataset.navId?t.classList.remove("sub-toggle-block"):t.classList.add("sub-toggle-block"),e.target.parentElement.insertBefore(t,e.target.nextSibling))}};document.querySelector('[data-add-nav="pageButton"]').addEventListener("click",(function(){y.forEach((e=>{if(e.checked){let t={pageId:e.dataset.pageId,pageTitle:e.dataset.pageTitle};e.checked=!1,E.push(t)}})),b()}),!1),document.querySelector('[data-add-nav="collectionButton"]').addEventListener("click",(function(){S.forEach((e=>{if(e.checked){let t={collectionId:e.dataset.collectionId,collectionTitle:e.dataset.collectionTitle};e.checked=!1,E.push(t)}})),b()}),!1),document.querySelector('[data-add-nav="placeholderButton"]').addEventListener("click",(function(){if(T[0].value){let e={navTitle:T[0].value,url:T[1].value};T[0].value="",T[1].value="",E.push(e)}b()}),!1),document.addEventListener("click",(function(e){if(!e.target.dataset.deleteNavigationPrompt)return;if(!confirm(e.target.dataset.deleteNavigationPrompt))return;let t=[],a=e.target.closest('[data-navigation="parent"]');if(a.querySelectorAll('input[name$="[navId]"]').forEach((e=>{let a=parseInt(e.value);isNaN(a)||t.push(a)})),t.length>0){document.body.insertAdjacentHTML("afterbegin",n.spinnerHTML);let e=JSON.stringify(t);f(n.routes.adminNavigationDelete,{navIds:e}).then((()=>{a.remove()})).then((()=>{l()})).catch((e=>{l(),o("danger","Failed to delete navigation",e)})),t.length=0}else a.remove()}),!1),document.querySelectorAll('[data-draggable="children"]').forEach((e=>{e.addEventListener("dragstart",s,!1),e.addEventListener("dragenter",u,!1),e.addEventListener("dragover",m,!1),e.addEventListener("dragleave",g,!1),e.addEventListener("drop",M,!1),e.addEventListener("dragend",p,!1)})),document.querySelectorAll('[data-add-nav="page"], [data-add-nav="collection"], [data-add-nav="placeholder"]').forEach((e=>{e.addEventListener("input",(e=>{e.stopPropagation()}))}))})();