{"version":3,"sources":["modules/formControl.js","modules/alert.js","modules/collapse.js","modules/main.js","modules/spinner.js","modules/xhrPromise.js","modules/modal.js","modules/mediaModal.js","modules/url.js","pageEdit.js"],"names":["enableFormControl","control","disabled","disableFormControl","dismissAlertInlineMessage","event","target","dataset","dismiss","closest","remove","alertInlineMessage","severity","heading","message","container","document","createElement","innerHTML","pitonConfig","alertInlineHTML","querySelector","classList","add","join","insertAdjacentHTML","window","scrollTo","collapseToggle","collapse","collapseTarget","toggle","querySelectorAll","forEach","form","saveButtons","addEventListener","e","confirm","preventDefault","deletePrompt","enableSpinner","contains","disableSpinner","XHRPromise","method","url","data","xhr","XMLHttpRequest","Promise","resolve","reject","onreadystatechange","readyState","DONE","status","response","JSON","parse","responseText","text","error","open","setRequestHeader","send","getXHRPromise","params","queryString","Object","keys","map","k","encodeURIComponent","postXHRPromise","csrfTokenName","csrfTokenValue","postData","modal","getElementById","getModal","showModal","showModalContent","header","body","buttons","hideModal","inputEvent","Event","openMediaModal","elementTarget","routes","adminMediaGet","then","mediaId","mediaCaption","mediaPath","targetInput","targetImg","value","id","src","filename","alt","caption","title","dispatchEvent","mediaSelect","mediaModal","mediaClear","pageSlug","setCleanSlug","urlSlugStatus","replace","unlockSlug","readOnly","alert","setElementTitleText","matches","initMarkdownEditor","element","SimpleMDE","forceSync","promptURLs","toolbar","addEl","limit","parseInt","elementCountLimit","count","elementCount","query","blockKey","adminPageElementGet","targetBlock","newEditor","lastElementChild","windowTarget","getAttribute","catch","pageEditNode","deleteElementPrompt","elementId","isNaN","adminPageElementDelete","console","log","elementEnableInput","elementParent","requiredOption","option","elementInputOption","editor"],"mappings":"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","file":"pageEdit.js","sourceRoot":"..","sourcesContent":["/**\n * Enable Form Control\n *\n * @param {object} control Control button element\n */\nconst enableFormControl = function(control) {\n    if (control && control.disabled) {\n        control.disabled = false;\n    }\n}\n\n/**\n * Disable Form Control\n *\n * @param {object} control Control button element\n */\nconst disableFormControl =  function(control) {\n    if (control && !control.disabled) {\n        control.disabled = true;\n    }\n}\n\nexport { enableFormControl, disableFormControl };","/**\n * Dismiss Inline Alert\n * @param {Event} event\n */\nconst dismissAlertInlineMessage = function(event) {\n    if (event.target.dataset.dismiss === \"alert\") {\n        event.target.closest(`[data-alert=\"container\"]`).remove();\n    }\n}\n\n/**\n * Display Inline HTML Message Alert\n * @param {string} severity Severity color code\n * @param {string} heading  Message heading\n * @param {mixed} message   Message list\n */\nconst alertInlineMessage = function(severity, heading, message) {\n    // Create element and insert alert HTML and update with alert data\n    let container = document.createElement(\"div\");\n    container.innerHTML = pitonConfig.alertInlineHTML;\n    container.querySelector(`[data-alert=\"container\"]`).classList.add(\"alert-\" + severity);\n    container.querySelector(`[data-alert=\"heading\"]`).innerHTML = heading;\n\n    // Stringify message\n    if (typeof message === 'object') {\n        message = message.join(\"<br>\");\n    }\n    container.querySelector(`[data-alert=\"content\"]`).innerHTML = message;\n\n    // Insert into main or body\n    let mainContainer = document.querySelector(\"main.main-content\");\n    mainContainer.insertAdjacentHTML('afterbegin', container.innerHTML);\n    window.scrollTo(0,0);\n}\n\nexport { alertInlineMessage, dismissAlertInlineMessage };","/**\n * Collapse Toggle\n * @param {Event} event\n */\nconst collapseToggle = function(event) {\n    if (event.target.dataset.collapse === 'toggle') {\n        let collapseTarget = event.target.closest(`[data-collapse=\"parent\"]`).querySelector(`[data-collapse=\"target\"]`);\n\n        if (collapseTarget) {\n            collapseTarget.classList.toggle(\"collapsed\");\n        }\n    }\n}\n\nexport { collapseToggle };","// --------------------------------------------------------\n// Main JS\n// --------------------------------------------------------\n\nimport { enableFormControl, disableFormControl } from './formControl.js';\nimport { dismissAlertInlineMessage } from './alert.js';\nimport { collapseToggle } from './collapse.js';\n\n// Form Control Events\ndocument.querySelectorAll(\"form\").forEach(form => {\n    // Disable form controls and listen for form input changes to re-enable save controls\n    let saveButtons = form.querySelectorAll(`[data-form-button=\"save\"]`);\n    if (saveButtons) {\n        saveButtons.forEach(control => {\n            disableFormControl(control);\n        });\n\n        // Listen for form changes to reenable controls\n        form.addEventListener(\"input\", (e) => {\n            saveButtons.forEach(control => {\n                enableFormControl(control);\n            });\n        });\n    }\n\n    // Confirm discard of changes\n    form.querySelectorAll(`[data-form-button=\"cancel\"]`).forEach(control => {\n        control.addEventListener(\"click\", (e) => {\n            let userResponse = confirm(\"Click Ok to discard your changes, or cancel continue editing?\");\n            if (!userResponse) e.preventDefault();\n        });\n    });\n\n    // Confirm delete\n    form.querySelectorAll(`[data-delete-prompt]`).forEach(control => {\n        control.addEventListener(\"click\", (e) => {\n            if (!confirm(e.target.dataset.deletePrompt)) e.preventDefault();\n        });\n    });\n});\n\n// Binding click events to document\ndocument.addEventListener(\"click\", dismissAlertInlineMessage);\ndocument.addEventListener(\"click\", collapseToggle);","/**\n * Enable Spinner Overlay\n * @param {void}\n */\nconst enableSpinner = function() {\n    if (document.querySelector(\"body > .spinner\").classList.contains(\"d-none\")) {\n        document.querySelector(\"body > .spinner\").classList.remove(\"d-none\")\n    }\n}\n\n/**\n * Disable Spinner Overlay\n * @param {void}\n */\nconst disableSpinner = function() {\n    if (!document.querySelector(\"body > .spinner\").classList.contains(\"d-none\")) {\n        document.querySelector(\"body > .spinner\").classList.add(\"d-none\")\n    }\n}\n\nexport { enableSpinner, disableSpinner };","import { alertInlineMessage } from './alert.js';\nimport { disableSpinner } from './spinner.js';\n\n/**\n * XHR Request Promise\n * @param {string} method \"GET\"|\"POST\"\n * @param {string} url    Resource request URL\n * @param {mixed}  data   String or object\n */\nconst XHRPromise = function(method, url, data) {\n    let xhr = new XMLHttpRequest();\n\n    return new Promise((resolve, reject) => {\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState !== XMLHttpRequest.DONE) return;\n\n            try {\n                if (xhr.status === 200) {\n                    // Successful server response\n                    let response = JSON.parse(xhr.responseText);\n                    if (response.status === \"success\") {\n                        // Response content successful\n                        resolve(response.text);\n                    } else {\n                        // Response successful but application failed\n                        reject(alertInlineMessage('danger', 'Failed', [response.text]));\n                    }\n                } else {\n                    // Failed server runtime response\n                    reject(alertInlineMessage('danger', 'Failed', [response.text]));\n                    disableSpinner();\n                }\n            } catch (error) {\n                reject(alertInlineMessage('danger', 'Error', [error]));\n                disableSpinner();\n            }\n        }\n\n        // Setup and send\n        xhr.open(method, url, true);\n        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr.send(data);\n    });\n}\n\n/**\n * GET XHR Promise Request\n * @param {string} url    Resource URL\n * @param {string} params Query string parameters\n */\nconst getXHRPromise = function(url, params) {\n    let queryString;\n\n    // Accept query string or build from object\n    if (typeof params === 'string') {\n        queryString = params;\n    } else if (typeof params === 'object') {\n        queryString = Object.keys(params).map((k) => {\n            return encodeURIComponent(k) + '=' + encodeURIComponent(params[k])\n        }).join('&');\n    }\n\n    // Attach query string to URL\n    if (queryString) {\n        url += '?' + queryString;\n    }\n\n    return XHRPromise(\"GET\", url);\n}\n\n/**\n * POST XHR Promise Request\n * @param {string} url  Resource URL\n * @param {string} data FormData object or object key value pairs\n */\nconst postXHRPromise = function(url, data) {\n    data = data || {};\n    data[pitonConfig.csrfTokenName] = pitonConfig.csrfTokenValue\n\n    // Serialize data\n    let postData = Object.keys(data).map((k) => {\n        return encodeURIComponent(k) + '=' + encodeURIComponent(data[k])\n    }).join('&');\n\n    return XHRPromise(\"POST\", url,  postData);\n}\n\nexport { getXHRPromise, postXHRPromise };\n","// Get base modal HTML available in all pages\nconst modal = document.getElementById(\"modal\");\n\n/**\n * Get Modal\n * Returns modal object\n */\nconst getModal = function() {\n    return modal;\n}\n\n/**\n * Show Modal (Background)\n * Call first if request requires processing before content is available\n */\nconst showModal = function() {\n    modal.classList.remove(\"d-none\");\n}\n\n/**\n * Load Modal Content and Display\n * @param {string} header\n * @param {string} body\n * @param {object} buttons\n */\nconst showModalContent = function(header, body, buttons) {\n    modal.querySelector(`[data-modal=\"header\"]`).innerHTML = header;\n    modal.querySelector(`[data-modal=\"body\"]`).innerHTML = body;\n    modal.classList.remove(\"d-none\");\n    modal.querySelector(`[data-modal=\"content\"]`).classList.remove(\"d-none\");\n}\n\n/**\n * Hide Modal and Clear Contents\n */\nconst hideModal = function() {\n    modal.classList.add(\"d-none\");\n    modal.querySelector(`[data-modal=\"content\"]`).classList.add(\"d-none\");\n    modal.querySelector(`[data-modal=\"header\"]`).innerHTML = \"\";\n    modal.querySelector(`[data-modal=\"body\"]`).innerHTML = \"\";\n}\n\n// Bind close modal events\nmodal.querySelector(`[data-dismiss=\"modal\"]`).addEventListener(\"click\", () => {\n    hideModal();\n});\nwindow.addEventListener(\"click\", (event) => {\n    if (event.target === modal) {\n        hideModal();\n    }\n});\n\nexport { getModal, showModal, showModalContent, hideModal };\n","import { getModal, showModal, showModalContent, hideModal } from './modal.js';\nimport { getXHRPromise } from './xhrPromise.js';\n\n/**\n * Event to dispatch pseudo \"input\" event on hidden inputs\n */\nconst inputEvent = new Event(\"input\", {\"bubbles\": true});\n\n/**\n * Opens Modal with Media Images for Select\n * @param {Element} elementTarget Media target\n */\nconst openMediaModal = function(elementTarget) {\n    showModal();\n    getXHRPromise(pitonConfig.routes.adminMediaGet)\n        .then(data => {\n            showModalContent(\"Select Media\", data);\n        });\n\n    // Add click listener to set media ID on select and dismiss\n    getModal().querySelector(`[data-modal=\"content\"]`).addEventListener(\"click\", (e) => {\n        if (e.target.closest(`[data-media=\"1\"]`)) {\n            // Get media data and set in form\n            let data = {\n                \"id\": e.target.closest(`[data-media=\"1\"]`).dataset.mediaId,\n                \"caption\": e.target.closest(`[data-media=\"1\"]`).dataset.mediaCaption,\n                \"filename\": e.target.closest(`[data-media=\"1\"]`).dataset.mediaPath\n            }\n\n            // Set ID, filename and relative path, an caption in target element\n            let targetInput = elementTarget.querySelector(`input[name*=\"media_id\"]`);\n            let targetImg = elementTarget.querySelector(\"img\");\n\n            targetInput.value = data.id;\n            targetImg.src = data.filename;\n            targetImg.alt = data.caption;\n            targetImg.title = data.caption;\n            targetImg.classList.remove(\"d-none\");\n\n            // Dispatch input event on hidden field\n            targetInput.dispatchEvent(inputEvent);\n\n            hideModal();\n        }\n    });\n}\n\n// Media select modal\nconst mediaSelect = function(event) {\n    if (event && event.target.dataset.mediaModal) {\n        // Launch media modal with target element\n        openMediaModal(event.target.closest(`[data-media-select=\"1\"]`));\n    } else if (event.target.dataset.mediaClear) {\n        // Clear media from form\n        let targetInput = event.target.closest(`[data-media-select=\"1\"]`).querySelector(`input[name*=\"media_id\"]`);\n        let targetImg = event.target.closest(`[data-media-select=\"1\"]`).querySelector(\"img\");\n\n        targetInput.value = \"\";\n        targetImg.src = \"\";\n        targetImg.alt = \"\";\n        targetImg.title = \"\";\n        targetImg.classList.add(\"d-none\");\n\n        // Dispatch event on hidden field\n        targetInput.dispatchEvent(inputEvent);\n    }\n}\n\nexport { mediaSelect };","const pageSlug = document.querySelector(`[data-url-slug=\"target\"]`);\n\n/**\n * Clean URL Slug\n * @param {string} value\n */\nconst setCleanSlug = function(value) {\n    // Do not change the home page\n    if (pageSlug.value === 'home') return;\n\n    if (pageSlug.dataset.urlSlugStatus === 'unlock') {\n        value = value.replace(/&/g, 'and');\n        value = value.replace(`'`, '');\n        value = value.replace(/[^a-z0-9]+/gi, '-');\n        value = value.replace(/-+$/gi, '');\n\n        pageSlug.value = value;\n    }\n}\n\nconst unlockSlug = function(event) {\n    // Do not change the home page\n    if (pageSlug.value === 'home') {\n        alert(\"You cannot change the home page slug.\");\n        return;\n    };\n\n    const message = 'Are you sure you want to change the URL Slug? This can impact links and search engine results.';\n\n    if (event.target.classList.contains(\"fa-lock\")) {\n        if (!confirm(message)) return;\n\n        // Continue to unlock and enable input\n        event.target.classList.replace(\"fa-lock\", \"fa-unlock\");\n        pageSlug.readOnly = false;\n        pageSlug.dataset.urlSlugStatus = 'unlock';\n    }\n}\n\nexport { setCleanSlug, unlockSlug };","// --------------------------------------------------------\n// Page Edit JS\n// --------------------------------------------------------\n\nimport './modules/main.js';\nimport { enableSpinner, disableSpinner } from './modules/spinner.js';\nimport { getXHRPromise, postXHRPromise } from './modules/xhrPromise.js';\nimport { mediaSelect } from './modules/mediaModal.js';\nimport { setCleanSlug, unlockSlug } from './modules/url.js';\n\n/**\n * Set Element Title\n */\nconst setElementTitleText = function(event) {\n    if (event.target.matches(`input[name^=\"element_title\"]`)) {\n        let title = event.target.value;\n        let elementTitle = event.target.closest(`[data-element=\"parent\"]`).querySelector(\".secondary-title\");\n        elementTitle.innerHTML = title;\n    }\n}\n\n/**\n * Markdown Editor\n * @param {object} element\n */\nconst initMarkdownEditor = function(element) {\n    return new SimpleMDE({\n        element: element,\n        forceSync: true,\n        promptURLs: true,\n        toolbar: [\n          \"bold\", \"italic\", \"|\", \"heading-2\", \"heading-3\", \"|\", \"unordered-list\", \"ordered-list\", \"|\",\n          \"horizontal-rule\", \"table\", \"|\", \"link\",\n        //   {\n        //     name: \"image\",\n        //     // action: getMediaForMDE,\n        //     className: \"fa fa-picture-o\",\n        //     title: \"Media\"\n        //   },\n          \"guide\"\n        ]\n      });\n}\n\n// Add Page Block Element\ndocument.querySelectorAll(`a[data-element=\"add\"]`).forEach(addEl => {\n    addEl.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        let limit = parseInt(addEl.dataset.elementCountLimit) || 100;\n        let count = parseInt(addEl.dataset.elementCount) || 0;\n\n        // Check element limit\n        if (count >= limit) {\n            alert('This Block has the maximum number of Elements allowed by the design');\n            return;\n        }\n\n        // Get new element\n        enableSpinner();\n\n        // Get query string and XHR Promise\n        let query = {\n            \"pageTemplate\": document.querySelector(`input[name=\"template\"]`).value,\n            \"blockKey\": addEl.dataset.blockKey\n        }\n\n        getXHRPromise(pitonConfig.routes.adminPageElementGet, query)\n            .then(response => {\n                let container = document.createElement(\"div\");\n                let targetBlock = document.getElementById(\"block-\" + addEl.dataset.blockKey);\n                container.innerHTML = response;\n\n                // Set element order number and update count in add element data-element-count\n                addEl.dataset.elementCount = ++count;\n\n                container.querySelector(`[data-element=\"parent\"]`).classList.add(\"new-element\");\n                targetBlock.insertAdjacentHTML('beforeend', container.innerHTML);\n\n                // Unable to initalize SimpleMDE on the unattached HTML fragment until we insert it\n                let newEditor = targetBlock.lastElementChild.querySelector(`textarea[data-mde=\"1\"]`);\n                initMarkdownEditor(newEditor);\n\n                // Get new block ID for window scroll\n                let windowTarget = container.querySelector(`[data-element=\"parent\"]`).getAttribute(\"id\");\n\n                return windowTarget;\n            })\n            .then(target => {\n                // TODO Smooth scroll leaving room for navs\n                // window.location.hash = target;\n            })\n            .then(() => {\n                disableSpinner();\n            }).catch(() => {\n                disableSpinner();\n            });\n    });\n});\n\n// Get Page Edit block\nconst pageEditNode = document.querySelector(`[data-page-edit=\"1\"]`);\n\n// Delete element\nif (pageEditNode) {\n    pageEditNode.addEventListener(\"click\", (event) => {\n        if (event.target.dataset.deleteElementPrompt) {\n            // Confirm delete\n            if (!confirm(event.target.dataset.deleteElementPrompt)) return;\n\n            // Get element ID and element\n            let elementId = parseInt(event.target.dataset.elementId);\n            let element = event.target.closest(`[data-element=\"parent\"]`);\n\n            if (isNaN(elementId)) {\n                // Element has not been saved to DB, just remove from DOM\n                element.remove();\n            } else {\n                // Element has been saved, do a hard delete\n                enableSpinner();\n                let data = {\n                    \"elementId\": elementId\n                }\n\n                postXHRPromise(pitonConfig.routes.adminPageElementDelete, data)\n                    .then(() => {\n                        element.remove();\n                    })\n                    .then(() => {\n                        disableSpinner();\n                    }).catch((data) => {\n                        console.log(\"Failed to delete element: \", data);\n                        disableSpinner();\n                    });\n            }\n        }\n    });\n}\n\n// Enable additional inputs on elements when selected\nif (pageEditNode) {\n    pageEditNode.addEventListener(\"click\", (event) => {\n        if (event.target.dataset.elementEnableInput) {\n            let elementParent = event.target.closest(`[data-element=\"parent\"]`);\n            let requiredOption = event.target.dataset.elementEnableInput;\n\n            // Get special inputs and set visible or hide class\n            elementParent.querySelectorAll(`[data-element-input-option]`).forEach(option => {\n                if (requiredOption === option.dataset.elementInputOption) {\n                    option.classList.remove(\"d-none\");\n                    option.classList.add(\"d-block\");\n                } else {\n                    option.classList.add(\"d-none\");\n                    option.classList.remove(\"d-block\");\n                }\n\n            });\n        }\n    });\n}\n\n// Bind Markdown Editor to selected textareas on page load\nif (pageEditNode) {\n    pageEditNode.querySelectorAll(`textarea[data-mde=\"1\"]`).forEach(editor => {\n        initMarkdownEditor(editor);\n    });\n}\n\n// Bind set page slug from page title\ndocument.querySelector(`[data-url-slug=\"source\"]`).addEventListener(\"input\", (e) => {\n    setCleanSlug(e.target.value);\n});\n\n// Bind warning on unlocking page slug\ndocument.querySelector(`[data-url-slug-lock=\"1\"]`).addEventListener(\"click\", (e) => {\n    unlockSlug(e);\n});\n\n// Bind page edit listeners for events that bubble\ndocument.addEventListener(\"click\", mediaSelect);\ndocument.addEventListener(\"change\", setElementTitleText);\n\n/*\n\n// Bind Markdown Editor to Textareas\nlet getMediaForMDE = function (editor) {\n    // Bind media click once, and load media in modal\n    $('#mediaModal').unbind().on('click', 'img', function () {\n      let imgsrc = $(this).data('source');\n      let imgalt = $(this).data('caption');\n      let output = '![' + imgalt + '](' + imgsrc + ') ';\n      editor.codemirror.replaceSelection(output);\n      editor.codemirror.focus();\n\n      $('#mediaModal').modal('hide');\n    });\n\n    $.ajax({\n      url: pitonConfig.routes.adminMediaGet,\n      method: \"GET\",\n      success: function (r) {\n        $('#mediaModal').find('.modal-body').html(r.html).end().modal();\n      }\n    });\n  };\n\n  [].forEach.call(document.getElementsByClassName('jsMDE'), element => {\n    let simplemde = new SimpleMDE({\n      element: element,\n      forceSync: true,\n      promptURLs: true,\n      toolbar: [\n        \"bold\", \"italic\", \"|\", \"heading-2\", \"heading-3\", \"|\", \"unordered-list\", \"ordered-list\", \"|\",\n        \"horizontal-rule\", \"table\", \"|\", \"link\",\n        {\n          name: \"image\",\n          action: getMediaForMDE,\n          className: \"fa fa-picture-o\",\n          title: \"Media\"\n        },\n        \"guide\"\n      ]\n    });\n  });\n\n/* */\n"]}