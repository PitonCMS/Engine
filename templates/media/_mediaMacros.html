{#
    All Twig Macros for Media and Media Category Management
#}

{#
  Media Card
#}
{% macro card(media, categories) %}
<div class="media" data-media-card="true" data-media-id="{{ media.id }}" draggable="true">

  {# Media Image Thumbnail for preview 100px wide with hover popup larger image #}
  <div class="mediaImage">
    <img src="{{ getMediaPath(media.filename, 'thumb') }}" class="mediaThumb" alt="{{ media.caption }}" title="{{ media.caption }}">
  </div>

  {# TODO: Integrate fly up Edit button to launch fly out form fields to edit.
  <div class="mediaMeta">
    {# Media Caption
    <h5 class="mediaCaption">{{ media.caption }}</h5>
    {# Assigned Media Categories
    <div class="mediaCategories">
      {% for key, cat in media.categories %}
      <div class="mediaCategory">{{ categories[key] }}</div>
      {% endfor %}
    </div>

    {# Media Controls
    <div class="mediaControls">
      <button class="btn btn-save" type="button">Edit</button>
      <button class="btn btn-delete" type="button" data-delete-media-prompt="Are you sure you want to delete?"
        data-delete-media-id="{{ media.id }}">Delete</button>
    </div>
  </div>
  #}

  <div class="mediaExtra">
    {# TODO Need to give some visual response that the click copy happened #}
    <i class="fas fa-link mediaLink" title="Copy media link to clipboard"
      data-media-click-copy="{{ getMediaPath(media.filename, 'large') }}"></i>
    {# Featured Media Flag #}
    {% if media.feature == 'Y' %}
    <div class="mediaFeatured" title="Featured Image">F</div>
    {% endif %}
  </div>

  <div data-media-edit-form="true">
    <form accept-charset="utf-8">
      <input type="hidden" name="media_id" value="{{ media.id }}">

      {# Featured Media Flag #}
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="feature-{{ media.id }}" name="feature"
          {{ checked(media.feature) }}>
        <label class="form-check-label" for="feature-{{ media.id }}">Featured Media</label>
      </div>

      <hr>
      {# Media Categories #}
      <div class="mediaCategories">
        {% for key, cat in categories %}
        <div class="form-check">
          {% set forId = uniqueKey() %}
          <input class="form-check-input" type="checkbox" id="{{ forId }}" name="category[]"
            value="{{ key }}" {{ checked(media.categories[key]) }}>
          <label class="form-check-label" for="{{ forId }}">{{ cat }}</label>
        </div>
        {% endfor %}
      </div>

      <hr>
      <div class="form-group">
        <input type="text" name="caption" maxlength="100" value="{{ media.caption }}">
      </div>

      <hr>
      <div class="form-group">
        <button class="btn btn-delete" type="button" data-delete-media-prompt="Are you sure you want to delete?"
          data-delete-media-id="{{ media.id }}">Delete</button>
        <button class="btn btn-cancel" type="reset" data-form-button="cancel" disabled>Discard</button>
        <button class="btn btn-save" type="button" data-form-button="save" disabled>Save</button>
      </div>
    </form>
  </div>

</div>
{% endmacro card %}

{#
    Media Upload Modal
#}
{% macro uploadForm() %}
<form data-media-upload="form" method="post" accept-charset="utf-8" enctype="multipart/form-data">

  {# Media file link #}
  <div class="form-group">
    <input type="file" class="custom-file-input" id="media-file" name="media-file" required>
    {# <label class="custom-file-label" for="media-file">Choose a file</label> #}
    <div class="modal-info">
      <p class="small-text text-info"> Put warning/info text here</p>
    </div>
  </div>

  <hr>
  {# Featured image flag #}
  <div class="form-check-wrapper">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="featured-media" name="feature">
      <label class="form-check-label" for="featured-media" title="May be used for enhanced displays">Featured
        Media</label>
    </div>
  </div>

  <hr>
  {# List of all available categories #}
  <div class="form-check-wrapper">
    {% for key, name in getMediaCategories() %}
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="cat-{{ key }}" name="category[]" value="{{ key }}">
      <label class="form-check-label" for="cat-{{ key }}">{{ name }}</label>
    </div>
    {% endfor %}
  </div>


  <hr>
  {# Media caption #}
  <div class="form-group">
    {# <label>Caption</label> #}
    <input type="text" name="caption" maxlength="100" autocomplete="off" placeholder="Media caption">
  </div>

  {# Only display optimize checkbox if there is a Tinyfy key saved in settings #}
  {% if site.settings.tinifyApiKey %}
  <hr>
  <div class="form-check-wrapper">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="media-optimize" name="optimize" checked>
      <label class="form-check-label" for="media-optimize">Optimize Media</label>
    </div>
  </div>

  <div class="modal-info">
    <p class="small-text"> Create web optimized copies of your image using your Tinify account.</p>
  </div>
  <hr class="mt-1rem">

  {% endif %}

  {# Upload button #}
  <div class="btn-group">
    <button class="btn btn-save " type="button" data-media-upload="file">Upload</button>
  </div>
</form>

{% endmacro uploadForm %}
