{% extends '@admin/_adminSideBarBase.html' %}
{% import _self as html %}

{% block htmlTitle 'Messages' %}
{% block headText 'Manage Messages' %}
{% block sectionText 'messages' %}

{% block sideNav %}
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link {{ (currentRoute('adminMessages') and inUrl('new')) ? 'active' }}" href="{{ pathFor('adminMessages', {'status': 'new'}) }}">New Messages</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {{ (currentRoute('adminMessages') and inUrl('read')) ? 'active' }}" href="{{ pathFor('adminMessages', {'status': 'read'}) }}">Read Messages</a>
        </li>
    </ul>
{% endblock sideNav %}

{% block subBody %}
    {% if page.status == 'new' %}
        {% for m in page.messages if m.isRead == 'N' %}
            {{ html.message(m) }}
        {% else %}
            <p>You have no unread messages.</p>
        {% endfor %}

    {% else %}

        {% for m in page.messages if m.isRead == 'Y' %}
            {{ html.message(m) }}
        {% else %}
            <p>You have no read messages.</p>
        {% endfor %}
    {% endif %}
{% endblock subBody %}

{% macro message(m) %}
    <div class="jsMessageWrap">
        <form action="{{ pathFor('adminMessageSave') }}" method="post" accept-charset="utf-8">
            <input type="hidden" name="{{ site.csrf.name }}" value="{{ site.csrf.value }}">
            <input type="hidden" name="id" value="{{ m.id }}">
            <button class="btn btn-{% if m.isRead == 'Y' %}outline-{% endif %}primary btn-sm" type="submit" name="button" value="toggle" data-is-read="{{ m.isRead }}">Mark as
                {% if m.isRead == 'Y' %}Unread{% else %}Read
                {% endif %}
            </button>
            <button class="btn btn-outline-danger btn-sm" name="button" title="Delete message" type="submit" value="delete">Delete</button>
        </form>
        <p>
            <a href="mailto:{{ m.email }}" target="_blank">{{ m.email }}</a>
            {{ m.createdDate|date('d F Y  h:i a') }}
        </p>
        <p>{{ m.message }}</p>
    </div>
{% endmacro %}
