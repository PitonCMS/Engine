{% extends '@admin/_adminBase.html' %}
{% import _self as html %}

{% block headText 'Messages' %}

{% block body %}
  <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
		<li class="nav-item">
		  <a class="nav-link active" id="pills-new-tab" data-toggle="pill" href="#pills-new" role="tab" aria-controls="pills-new" aria-selected="true">New</a>
		</li>
		<li class="nav-item">
		  <a class="nav-link" id="pills-all-tab" data-toggle="pill" href="#pills-all" role="tab" aria-controls="pills-all" aria-selected="false">All</a>
		</li>
  </ul>

  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-new" role="tabpanel" aria-labelledby="pills-new-tab">
      {% for m in page.messages if m.isRead == 'N' %}
        {{ html.message(m) }}
      {% else %}
      <p>You have no unread messages.</p>
      {% endfor %}
    </div>
    <div class="tab-pane fade show" id="pills-all" role="tabpanel" aria-labelledby="pills-all-tab">
      {% for m in page.messages %}
        {{ html.message(m) }}
      {% else %}
      <p>You have no messages.</p>
      {% endfor %}
    </div>
  </div>
{% endblock body %}

{% macro message(m) %}
  <div>
    <div>
      <form action="{{ pathFor('adminMessageSave') }}" method="post" accept-charset="utf-8">
          <input type="hidden" name="{{ site.csrf.name }}" value="{{ site.csrf.value }}">
          <input type="hidden" name="id" value="{{ m.id }}">
          <button class="btn btn-primary btn-sm" type="submit"  name="button" value="toggle">Mark as {% if m.isRead == 'Y' %}Unread{% else %}Read{% endif %}</button>
          <button class="btn btn-outline-danger btn-sm" type="submit"  name="button" value="delete" title="Delete message">Delete</button>
        </form>
    </div>
    <p>
      <a href="mailto:{{ m.email }}" target="_blank">{{ m.email }}</a>
      {{ m.createdDate|date('d F Y  h:i a') }} Read: {{ m.isRead }}
    </p>
    <p>{{ m.message }}</p>
  </div>
{% endmacro %}
