{% extends '@admin/_adminBase.html' %}
{% import _self as html %}

{% block htmlTitle 'Messages' %}

{% block contentHeader %}
<div class="content-header-inner">
  <div class="breadcrumb"></div>
  {# TODO under section-title add title to match the type of filter? Like Messages - Unread or Message Read #}
  <h1 class="section-title">Messages - All </h1>
  <div class="btn-group"></div>
</div>
{% endblock contentHeader %}

{% block content %}
<!-- Message Filters -->
<div class="filter-block">
  <div class="input-block">
    <div class="input-block__icon">
      <i class="fas fa-search"></i>
    </div>
    <div class="input-block__input">
      <input type="search" name="search" id="search" class="input-block__search-input" placeholder="Search Media"
        autocomplete="false">
    </div>
  </div>

  <div class="btn-dropdown-block ">
    <div class="btn btn-dropdown "><span>Filter</span> <span><i class="fas fa-chevron-down"></i></span>
    </div>
    <div class="form-check-wrapper form-group-block">
      <div class="form-check">
        <input class="form-check-input" type="radio" id="allMessages" name="status" value="allMessages">
        <label class="form-check-label" for="allMessages">All</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" id="unreadMessages" name="status" value="unreadMessages">
        <label class="form-check-label" for="unreadMessages">Unread</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" id="readMessages" name="status" value="readMessages">
        <label class="form-check-label" for="readMessages">Read</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" id="archiveMessages" name="status" value="archiveMessages">
        <label class="form-check-label" for="archiveMessages">Archive</label>
      </div>
    </div>
  </div>

</div>

<div class="content-block-messages">
  {% if page.status == 'new' %}

  {% for m in page.messages %}
  {% if m.isRead == 'N' %}
  {{ html.message(m) }}
  {% endif %}
  {% else %}
  <p>You have no unread messages.</p>
  {% endfor %}

  {% else %}

  {% for m in page.messages %}
  {% if m.isRead == 'Y' %}
  {{ html.message(m) }}
  {% endif %}
  {% else %}
  <p>You have no read messages.</p>
  {% endfor %}
  {% endif %}
</div>
{% endblock content %}

{% block foot %}
{{ getJsFileSource('navigation') }}
{% endblock foot %}

{% macro message(m) %}
<div class="message-block jsMessageWrap">

  <div class="message-wrapper">
    <div class="message-header span">
      <div class="message-link">
        <a href="mailto:{{ m.email }}" target="_blank">
          <i class="fas fa-envelope"></i>&nbsp;&nbsp;{{ m.name }}</a>
      </div>

      <div class="message-date">
        Sent:&nbsp;&nbsp;{{ m.createdDate|date('d F Y h:i a') }}
      </div>

      <div class="message-origin">
        Via:&nbsp;&nbsp; {{ m.context|default('Unknown Page') }}
      </div>
    </div>

    <div class="message-content">
      <p>{{ m.message|nl2br }}</p>
    </div>

    <form class="btn-group" action="{{ pathFor('adminMessageSave') }}" method="post" accept-charset="utf-8">

      <input type="hidden" name="{{ site.csrf.name }}" value="{{ site.csrf.value }}">
      <input type="hidden" name="id" value="{{ m.id }}">

      <button class="btn btn-block btn-delete " name="button" title="Delete message" type="submit"
        data-is-read="{{ m.isRead }}" value="delete" formaction="{{ pathFor('adminMessageDelete') }}">Delete</button>

      <button class="btn btn-block btn-save" type="submit" name="button" value="toggle"
        data-is-read="{{ m.isRead }}">Mark as {% if m.isRead == 'Y' %}Unread{% else %}Read{% endif %}
      </button>

    </form>

  </div>

</div>
{% endmacro %}