{% extends '@admin/_adminBase.html' %}
{% import _self as settingForm %}

{% block body %}

    <div class="row">
      <div class="col">
        <h2>Piton Site Settings</h2>
        <form action="{{ pathFor('saveSettings') }}" method="post" accept-charset="utf-8">

          <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="pills-site-tab" data-toggle="pill" href="#pills-site" role="tab" aria-controls="pills-site" aria-selected="true">Site</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-social-tab" data-toggle="pill" href="#pills-social" role="tab" aria-controls="pills-social" aria-selected="false">Social</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-custom-tab" data-toggle="pill" href="#pills-custom" role="tab" aria-controls="pills-custom" aria-selected="false">Custom</a>
            </li>
          </ul>

          <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-site" role="tabpanel" aria-labelledby="pills-site-tab">
              {% for setting in page.settings if setting.category == 'site' %}
                {% if setting.input_type == 'select' %}
                  {{ settingForm.selectHTML(setting, getSettingOptions(setting.setting_key)) }}
                {% elseif setting.input_type == 'textarea' %}
                  {{ settingForm.textareaHtml(setting) }}
                {% else %}
                  {{ settingForm.inputHtml(setting) }}
                {% endif %}
              {% endfor %}
            </div>

            <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
              {% for setting in page.settings if setting.category == 'contact' %}
                {% if setting.input_type == 'select' %}
                  {{ settingForm.selectHTML(setting, getSettingOptions(setting.setting_key)) }}
                {% elseif setting.input_type == 'textarea' %}
                  {{ settingForm.textareaHtml(setting) }}
                {% else %}
                  {{ settingForm.inputHtml(setting) }}
                {% endif %}
              {% endfor %}
            </div>

            <div class="tab-pane fade" id="pills-social" role="tabpanel" aria-labelledby="pills-social-tab">
              {% for setting in page.settings if setting.category == 'social' %}
                {% if setting.input_type == 'select' %}
                  {{ settingForm.selectHTML(setting, getSettingOptions(setting.setting_key)) }}
                {% elseif setting.input_type == 'textarea' %}
                  {{ settingForm.textareaHtml(setting) }}
                {% else %}
                  {{ settingForm.inputHtml(setting) }}
                {% endif %}
              {% endfor %}
            </div>

            <div class="tab-pane fade" id="pills-custom" role="tabpanel" aria-labelledby="pills-custom-tab">
              {% for setting in page.settings if setting.category == 'custom' %}
                {% if setting.input_type == 'select' %}
                  {{ settingForm.selectHTML(setting, getSettingOptions(setting.setting_key)) }}
                {% elseif setting.input_type == 'textarea' %}
                  {{ settingForm.textareaHtml(setting) }}
                {% else %}
                  {{ settingForm.inputHtml(setting) }}
                {% endif %}
              {% else %}
                <p><a href="{{ pathFor('showCustomSettings') }}">Add custom site setting</a></p>
              {% endfor %}
            </div>
          </div>

          <a class="btn btn-warning" href="{{ pathFor('adminHome') }}">Cancel</a>
          <button type="submit" name="button" class="btn btn-primary">Save</button>
        </form>
      </div>
    </div>

{% endblock %}

{# Standard Input HTML Macro #}
{% macro inputHtml(setting) %}
               <div class="form-group ">
                    <label>{{ setting.label }}</label>
                    <input type="hidden" name="id[]" value="{{ setting.id }}">
                    <input type="hidden" name="setting_key[]" value="{{ setting.setting_key }}">
                    <input type="text" class="form-control" name="setting_value[]" value="{{ setting.setting_value }}" autocomplete="off">
                    <small class="form-text text-muted">Key: <code>{{ setting.setting_key }}</code>. {{ setting.help }}</small>
                </div>
{% endmacro inputHtml %}

{# Select List HTML Macro #}
{% macro selectHtml(setting, options) %}
              <div class="form-group">
                <label>{{ setting.label }}</label>
                <input type="hidden" name="id[]" value="{{ setting.id }}">
                <input type="hidden" name="setting_key[]" value="{{ setting.setting_key }}">
                <select class="form-control" name="setting_value[]">
                  {% for key, option in options %}
                  <option value="{{ key }}" {% if key == setting.setting_value %}selected{% endif %}>{{ option }}</option>
                  {% endfor %}
                </select>
                <small class="form-text text-muted">Key: <code>{{ setting.setting_key }}</code>. {{ setting.help }}</small>
              </div>
{% endmacro selectHtml %}

{# Textarea HTML Macro #}
{% macro textareaHtml(setting) %}
               <div class="form-group ">
                    <label>{{ setting.label }}</label>
                    <input type="hidden" name="id[]" value="{{ setting.id }}">
                    <input type="hidden" name="setting_key[]" value="{{ setting.setting_key }}">
                    <textarea class="form-control" rows="3" name="setting_value[]">{{ setting.setting_value }}</textarea>
                    <small class="form-text text-muted">Key: <code>{{ setting.setting_key }}</code>. {{ setting.help }}</small>
                </div>
{% endmacro textareaHtml %}
